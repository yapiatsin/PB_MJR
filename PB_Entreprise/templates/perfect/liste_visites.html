{% extends 'perfect/base.html' %} 
{% load static %} 
{% block title %} Liste des visites {% endblock title %}  
{% block page_title %}
<img class="profile-user-img" style="border:none; height:45px;width:45px" src="{% static 'visit.png' %}" alt="User profile picture">Liste des visites
{% endblock page_title %} 

{% block page_action %}
    <a class="nav-link" data-toggle="modal" data-target="#modal-sm" style="font-size: 18px; color: #06497C; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); font-weight: 700;">filtre
        <i style="font-size: 20px; color: #06497C; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);" class="fa fa-calendar"></i>
    </a>
{% endblock page_action %}
{% block main_content %}

<div class="modal fade" id="modal-sm">
    <div class="modal-dialog modal-sm">
        <div class="modal-content" style="border-radius:25px;">
            <div class="modal-header">
                <h4 class="modal-title" style="font-weight:700;color: #06497C; font-size:15px;">FILTRE</h4>
                <button type="button" style="border-radius:25px;" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card-body">
                    <form id="basic-form" method="get" novalidate>
                        <div class="row clearfix">
                            <div class="col-12">
                                <label style="font-weight:700;color:rgba(152, 152, 152, 0.85); font-size:15px;">Date debut </label>
                                <div class="form-group">                                    
                                    {{ form.date_debut }}
                                </div>
                            </div>
                            <div class="col-12">
                                <label style="font-weight:700;color: rgba(152, 152, 152, 0.85); font-size:15px;">Date fin</label>
                                <div class="form-group">                                    
                                    {{ form.date_fin }}
                                </div>
                            </div>
                            <div class="col-12">
                                <label style="font-weight:700;color: rgba(152, 152, 152, 0.85); font-size:15px;">Categorie</label>
                                <div class="form-group">                                    
                                    {{ form.categorie }}
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary" style="border-radius:25px;" data-dismiss="modal">Annuler</button>
                            <a href="{% url 'list_visit' %}" class="btn btn-outline-info" style="border-radius:25px;"><i class="fa fa-refresh"></i></a>
                            <button type="submit" class="btn btn-outline-success" style="border-radius:25px;">Afficher</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="col-12 col-sm-6 col-md-4">
    <div class="info-box" style="border-radius:25px;">
        <span class="info-box-icon elevation-1" style="border-radius:25px; background-color:rgba(229, 229, 229, 0.51);"><i class="fas fa-clock" style="color:rgba(6, 73, 124, 0.54);"></i></span>
        <div class="info-box-content">
            <span class="info-box-text" style="font-size:18px; font-weight: 700; color: #06497C;">Aujourd'hui</span>
            <span class="info-box-number" style="font-size:20px;">
            {{visitech_jours_format}}
            <small>frs cfa</small>
            </span>
        </div>
    </div>
</div>
<div class="clearfix hidden-md-up"></div>
<div class="col-12 col-sm-6 col-md-4">
    <div class="info-box mb-3" style="border-radius:25px;">
    <span class="info-box-icon elevation-1" style="border-radius:25px; background-color:rgba(229, 229, 229, 0.51);"><i class="fa fa-calendar" style="color:rgba(6, 73, 124, 0.54);"></i></span>
    <div class="info-box-content">
        <span class="info-box-text" style="font-size:18px; font-weight: 700; color: #06497C;">Mensuelle</span>
        <span class="info-box-number" style="font-size:20px;">
        {{visitech_mois_format}}
        <small>frs cfa</small>
        </span>
    </div>
    </div>
</div>
<div class="clearfix hidden-md-up"></div>
<div class="col-12 col-sm-6 col-md-4" >
    <div class="info-box mb-3" style="border-radius:25px;">
        <span class="info-box-icon elevation-1" style="border-radius:25px; background-color:rgba(229, 229, 229, 0.51);"><i class="fas fa-calendar" style="color:rgba(6, 73, 124, 0.54);"></i></span>
        <div class="info-box-content">
            <span class="info-box-text" style="font-size:18px; font-weight: 700; color: #06497C;">Annuelle</span>
            <span class="info-box-number" style="font-size:20px;">
            {{visitech_an_format}}
            <small>frs cfa</small>
            </span>
        </div>
    </div>
</div>

<div class="col-md-12">
    <div class="row">
        <div class="col-md-12">
            <div class="" style="border-radius:20px">
                <div id="" class="">
                    <div class="row p-0 m-0">
                        <div class="col-md-12 p-0">
                            <div class="card" style="box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);backdrop-filter: blur(5.2px);-webkit-backdrop-filter: blur(5.2px); border-radius:20px; " >
                                <form method="post" action="{% url 'delete_selected_recettes' %}" id="deleteForm">
                                    {% csrf_token %}
                                    <div class="card-header">
                                        <h3 class="card-title">
                                            <button type="button" class="btn btn-default text-danger" id="printButton">PDF <i class='fa fa-file-pdf-o'></i></button>
                                            <button type="button" class="btn btn-default text-success">Excell <i class='fa fa-file-excel-o'></i></button>
                                        </h3>
                                        <div class="card-tools">
                                            <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div id="example1_wrapper" class="dataTables_wrapper dt-bootstrap4">
                                            <table id="example1" class="table table-bordered table-striped dataTable" role="grid" aria-describedby="example1_info">
                                                <thead>
                                                    <tr class="text-center text-danger">
                                                        <th><input type="checkbox" id="select-all"></th>
                                                        <th>IMMAT</th>
                                                        <th>MARQUE</th>
                                                        <th>CATEGORIE</th>
                                                        <th>MONTANT</th>
                                                        <th>DATE SAISIE</th>
                                                        <th>SAISIR PAR </th>
                                                        <th>ACTION</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% if liste_visitech %} 
                                                        {% for u in liste_visitech %}
                                                            <tr class="text-center">
                                                                <td><input type="checkbox" name="selected_recettes" value="{{ u.id }}"></td>
                                                                <td>
                                                                    <a href="#" class="mr-3 text-primary">{{u.vehicule.immatriculation}}</a>
                                                                </td>
                                                                <td>{{u.vehicule.marque}}</td>
                                                                <td>{{u.vehicule.category}}</td>
                                                                <td>{{u.montant}}</td>
                                                                <td>{{u.date_saisie|date:"d-m-y"}}</td>
                                                                <td>{{u.auteur.username}}</td>
                                                                <td class="text-center">
                                                                    {% for categorie, perms in grouped_permissions.items %}
                                                                        {% if categorie.categorie == 'permchargvar' %}
                                                                            {% for perm in perms %}
                                                                                {% if perm.name == "modifier Charge variable" %}
                                                                                    <a href="{% url perm.url u.pk %}" class="text-primary">
                                                                                        <i style="font-size: 20px;" class="fa fa-edit text-warning"></i>
                                                                                    </a>
                                                                                {% comment %} {% elif perm.name == "sup recette" %}
                                                                                    <a href="{% url perm.url u.pk %}" class="text-primary" onclick="return confirm('Etes-vous sûre de vouloir supprimer la recette de {{ u.montant }} du {{ u.vehicule.immatriculation }} saisie le {{ u.date_saisie|date:"d-m-y" }}? Toutes les informations liées seront supprimées.')">
                                                                                        <i style="font-size: 20px;" class="fa fa-trash text-danger"></i>
                                                                                    </a> {% endcomment %}
                                                                                {% endif %}
                                                                            {% endfor %}
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                </td>
                                                            </tr>
                                                        {% endfor %} 
                                                    {% endif %}
                                                </tbody>
                                                <tfoot>
                                                    <tr class="text-center ">
                                                        <th>
                                                            {% for categorie, perms in grouped_permissions.items %}
                                                                {% if categorie.categorie == 'permchargvar' %}
                                                                    {% for perm in perms %}
                                                                        {% if perm.name == "sup Charge variable" %}
                                                                            <button type="submit" class="btn btn-outline-danger" onclick="return confirm('Confirmez-vous la suppression des véhicules sélectionnés ?')">
                                                                                <i class="fa fa-trash"></i>
                                                                            </button>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                {% endif %}
                                                            {% endfor %}
                                                        </th>
                                                        <th>---</th>
                                                        <th>---</th>
                                                        <th>---</th>
                                                        <th>---</th>
                                                        <th>---</th>
                                                        <th>---</th>
                                                        <th>---</th>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('select-all').onclick = function() {
        let checkboxes = document.querySelectorAll('input[name="selected_recettes"]');
        for (let checkbox of checkboxes) {
            checkbox.checked = this.checked;
        }
    };
</script>
{% endblock main_content %}